<main>
  <h1>הדיווחים שלי</h1>
  <div>
    <div class="errorMessage" *ngIf="userAreaService.fetchREportsErrorMessage">
        <p>הפעולה נכשלה, נסה שוב או פנה לתמיכה טכנית</p>
        <i class="material-icons">
          highlight_off
          </i>
    </div>
    <mat-accordion>
      <mat-expansion-panel *ngFor="let company of records">
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{company.name}}
          </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-expansion-panel *ngFor="let record of company.records; let index = i">
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{record.createdAt}}
            </mat-panel-title>
          </mat-expansion-panel-header>

          <mat-spinner style="margin:auto" *ngIf="userAreaService.proccesingSpinner"></mat-spinner> 

          <div class="successMessage" *ngIf="userAreaService.successMessage">
            <p>הפעולה בוצעה בהצלה</p>
            <i class="material-icons">
              check_circle_outline
              </i>
          </div>

          <div class="errorMessage" *ngIf="userAreaService.errorMessage">
            <p>הפעולה נכשלה, נסה שוב או פנה לתמיכה טכנית</p>
            <i class="material-icons">
              highlight_off
              </i>
          </div>     

          <div class="form" *ngIf="!userAreaService.proccesingSpinner && !userAreaService.successMessage && !userAreaService.errorMessage ">
              <form #f="ngForm">
                <mat-form-field>
                  <input matInput type="number" [ngModel]="record.shotefPlus"  name="shotef_plus" placeholder="שוטף פלוס שסוכם בעסקה (30,40,60...)">
                </mat-form-field>

                <mat-form-field>
                  <input matInput type="number" [ngModel]="record.delay"  name="days_of_delay" placeholder="ימיי איחור אחרי תקופת שוטף פלוס">
                </mat-form-field>

                <mat-form-field>
                  <textarea matInput [ngModel]="record.comment"  name="comment" placeholder="הוסף הערה" cdkTextareaAutosize></textarea>
                </mat-form-field>
              </form>
              <div class="formActionButtons">
                <button mat-raised-button style="margin-left:2%" color="primary" 
                (click)="onButtonClick(record._id,'לשמור שינויים?','saveChanges', f.value)">שמור שינויים</button>
                <button mat-raised-button color="warn" (click)="onButtonClick(record._id,'למחוק דוח?','deleteReport',index)">מחק דיווח</button>
              </div>
            </div>  
        </mat-expansion-panel>
      </mat-expansion-panel>

    </mat-accordion>
  </div>
</main>